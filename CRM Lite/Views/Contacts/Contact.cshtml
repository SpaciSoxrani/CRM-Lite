@model CRM.Data.Dtos.Contact.ContactDto
﻿@{
    ViewData["Name"] = Model?.LastName;

    if (Model == null)
    {
        ViewData["Name"] = "Создание контакта";
    }
}
<form>
    @*asp-action="CreateOrUpdate" asp-controller="Contacts">*@
    <div class="animated fadeIn">
        <div class="card">
            <div class="card-body">
                <div class="row contactInfo">

                    <div class="col-md-6">

                        <div class="card">
                            <div class="card-header">
                                <strong>Общая информация</strong>
                                <div class="card-actions">
                                    <a href="#" class="btn btn-minimize" data-toggle="collapse"
                                       data-target="#common-info-card-body"
                                       aria-expanded="true"><i class="icon-arrow-up"></i></a>
                                </div>
                            </div>
                            <div id="common-info-card-body" class="card-body collapse show">

                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group required">
                                            <label for="last-name">Фамилия</label>
                                            <input type="text" class="form-control"
                                                   id="last-name" placeholder="Фамилия" required onkeyup="ucFirst(this)">
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="form-group required">
                                            <label for="first-name">Имя</label>
                                            <input type="text" class="form-control" id="first-name" placeholder="Имя" required onkeyup="ucFirst(this)">
                                        </div>
                                    </div>

                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="middle-name">Отчество</label>
                                            <input type="text" class="form-control" id="middle-name" placeholder="Отчество" onkeyup="ucFirst(this)">
                                        </div>
                                    </div>

                                </div>
                                <!--/.row-->

                                <div class="row">

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="job-title">Должность</label>
                                            <input type="text" class="form-control"
                                                   id="job-title" placeholder="Должность">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="department">Отдел</label>
                                            <input type="text" class="form-control"
                                                   id="department" placeholder="Отдел">
                                        </div>
                                    </div>

                                </div>
                                <!--/.row-->

                                <div class="row">

                                    <div class="col-md-2">
                                        <div class="form-group required">
                                            <label for="gender">Пол</label>
                                            <select style="width: 100%"
                                                    class="form-control" id="gender" required>
                                                <option value="" selected disabled>Не выбрано</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="birthday">День рождения</label>
                                            <input type="date" class="form-control" id="birthday"
                                                   placeholder="День рождения">
                                        </div>
                                    </div>

                                    <div class="col-md-2">
                                        <div class="form-group required">
                                            <label for="role">Роль</label>
                                            <select style="width: 100%"
                                                    class="form-control" id="role" required>
                                                <option value="" selected disabled>Не выбрано</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="col-md-5">
                                        <div class="form-group">
                                            <label for="organization">Организация</label>
                                            <select style="width: 100%"
                                                    class="form-control" id="organization">
                                                <option value="" selected disabled>Не выбрано</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <!--/.row-->
                            </div>
                        </div>


                        <div class="row">

                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <strong>Контактная информация</strong>
                                        <div class="card-actions">
                                            <a href="#" class="btn btn-minimize" data-toggle="collapse"
                                               data-target="#contact-info-card-body"
                                               aria-expanded="true"><i class="icon-arrow-up"></i></a>
                                        </div>
                                    </div>
                                    <div id="contact-info-card-body" class="card-body collapse show">

                                        <div class="col-md-12">
                                            <div class="form-group required">
                                                <label for="responsible">Ответственный</label>

                                                <select style="width: 100%"
                                                        class="form-control" id="responsible" required>
                                                    <option value="" selected disabled>Не выбрано</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="col-md-12">
                                            <div class="form-group required">
                                                <label for="email">E-mail</label>
                                                <input type="text" class="form-control" id="email" placeholder="E-mail" required>
                                            </div>
                                        </div>

                                        @if (ViewBag.IsAbleToSeePrivateEmail)
                                        {
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label for="private-email">Личный E-mail</label>
                                                    <input type="text" class="form-control" id="private-email" placeholder="Личный E-mail">
                                                </div>
                                            </div>
                                        }

                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="mobilephone">Мобильный телефон</label>
                                                <input type="text" class="form-control" id="mobilephone" placeholder="Мобильный телефон">
                                            </div>
                                        </div>

                                        <div class="col-md-12">
                                            <div class="form-group required">
                                                <label for="workphone">Рабочий телефон</label>
                                                <input type="text" class="form-control" id="workphone" placeholder="Рабочий телефон" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <strong>Помощник</strong>
                                        <div class="card-actions">
                                            <a href="#" class="btn btn-minimize" data-toggle="collapse"
                                               data-target="#assistant-info-card-body"
                                               aria-expanded="true"><i class="icon-arrow-up"></i></a>
                                        </div>
                                    </div>
                                    <div id="assistant-info-card-body" class="card-body collapse show">

                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="assistant-name">ФИО</label>
                                                <input type="text" class="form-control" id="assistant-name"
                                                       placeholder="ФИО">
                                            </div>
                                        </div>

                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="assistant-phone">Рабочий телефон</label>
                                                <input type="text" class="form-control" id="assistant-phone"
                                                       placeholder="Рабочий телефон">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="card">
                                    <div class="card-header">
                                        <strong>Руководитель</strong>
                                        <div class="card-actions">
                                            <a href="#" class="btn btn-minimize" data-toggle="collapse"
                                               data-target="#manager-info-card-body"
                                               aria-expanded="true"><i class="icon-arrow-up"></i></a>
                                        </div>
                                    </div>
                                    <div id="manager-info-card-body" class="card-body collapse show">

                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="manager-name">ФИО</label>
                                                <input type="text" class="form-control" id="manager-name" placeholder="ФИО">
                                            </div>
                                        </div>

                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="manager-phone">Рабочий телефон</label>
                                                <input type="text" class="form-control" id="manager-phone" placeholder="Рабочий телефон">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                    <!--/.col-->

                    <div class="col-md-6">

                        <div class="card">
                            <div class="card-header">
                                <strong>Адрес</strong>
                                <div class="card-actions">
                                    <a title="Заполнить значениями адреса выбранной организации"
                                       onclick="setAddressSameAsOrganizationAddress()" class="d-sm-down-none" href="#">
                                        <i class="icon-share-alt"></i>
                                    </a>

                                    <a href="#" class="btn btn-minimize" data-toggle="collapse"
                                       data-target="#address-info-card-body"
                                       aria-expanded="true"><i class="icon-arrow-up"></i></a>
                                </div>
                            </div>
                            <div id="address-info-card-body" class="card-body collapse show">

                                <div class="row">

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="country">Страна</label>
                                            <input type="text" class="form-control" id="country" placeholder="Страна" onkeyup="ucFirst(this)">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group required">
                                            <label for="city">Город</label>
                                            <input type="text" class="form-control" style="width: 100%; height: 2.5em;" id="city" name="city" placeholder="Город" required onkeyup="ucFirst(this)">
                                        </div>
                                    </div>

                                </div>
                                <!--/.row-->

                                <div class="row">

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="region">Регион</label>
                                            <input type="text" class="form-control" id="region" placeholder="Регион" onkeyup="ucFirst(this)">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="street">Улица</label>
                                            <input type="text" class="form-control" id="street" placeholder="Улица" onkeyup="ucFirst(this)">
                                        </div>
                                    </div>
                                </div>
                                <!--/.row-->

                                <div class="row">

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="index">Индекс</label>
                                            <input type="text" class="form-control" id="index" placeholder="Индекс">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="building">Дом</label>
                                            <input type="text" class="form-control" id="building" placeholder="Дом">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="office">Офис</label>
                                            <input type="text" class="form-control" id="office" placeholder="Офис" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">

                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header">
                                        <strong>Дополнительная информация</strong>
                                        <div class="card-actions">
                                            <a href="#" class="btn btn-minimize" data-toggle="collapse"
                                               data-target="#additional-info-card-body"
                                               aria-expanded="true"><i class="icon-arrow-up"></i></a>
                                        </div>
                                    </div>
                                    <div id="additional-info-card-body" class="card-body collapse show">

                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label for="interest">Источник интереса</label>
                                                    <select style="width: 100%"
                                                            class="form-control" id="interest">
                                                        <option value="" selected disabled>Не выбрано</option>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="col-md-5">
                                                <div class="form-group">
                                                    <label for="mailing-list">Списки рассылки</label>

                                                    <select multiple="multiple"
                                                            style="width:100%;" class="form-control"
                                                            id="mailing-list"></select>
                                                </div>
                                            </div>

                                            <div class="col-md-3">
                                                <div class="form-group text-center">
                                                    <label class="form-check mb-2" for="is-mail-allowed">Разрешить рассылку</label>
                                                    <label class="switch switch-3d switch-primary">
                                                        <input id="is-mail-allowed" type="checkbox"
                                                               class="switch-input">
                                                        <span class="switch-label"></span>
                                                        <span class="switch-handle"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-9">
                                                <div class="form-group">
                                                    <label for="notes">Заметки</label>
                                                    <textarea title="Иные дополнительные личные сведения и наблюдения менеджера по продажам по данному контакту"
                                                              class="form-control" id="notes" placeholder="Заметки"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group text-center">
                                                    <label class="form-check mb-2" for="is-active">Активен</label>
                                                    <label class="switch switch-3d switch-primary">
                                                        <input id="is-active" type="checkbox"
                                                               class="switch-input">
                                                        <span class="switch-label"></span>
                                                        <span class="switch-handle"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>



                        </div>
                    </div>
                    <!--/.col-->

                </div>
            </div>
            <div class="card-footer">
                <div class="form-actions text-center">
                    <input id="cancel" onclick="cancelEdits();" type="button" class="btn btn-secondary" value="Отменить">
                    <input id="submit" onclick="saveContact()" type="button" class="btn btn-primary" value="Сохранить">
                </div>
            </div>
        </div>

    </div>
</form>






@section Styles {
    <link href="~/lib/select2/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/suggestions-jquery@19.8.0/dist/css/suggestions.min.css" rel="stylesheet" />
    <style>
        .required-field-group-highlighted {
            outline: 2px solid red;
        }
    </style>



}


@section Scripts {
    <script src="https://unpkg.com/sweetalert2@7.19.3/dist/sweetalert2.all.js"></script>
    <script src="~/lib/jquery-loading-overlay-1.6.0/loadingoverlay.js" type='text/javascript'></script>
    <script src="~/lib/select2/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2.2.0/src/js.cookie.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/suggestions-jquery@19.8.0/dist/js/jquery.suggestions.min.js"></script>

    <script>
        $("select").select2({
            placeholder: "Выберите элемент",
            allowClear: true
        });

        var town;
        var organizationId = "@Model?.OrganizationId.ToString()";

        $("#city").suggestions({
            token: "3f21b0fab3cd3bb35b0925fd435d66fbc1879eef",
            type: "ADDRESS",
            /* Вызывается, когда пользователь выбирает одну из подсказок */
            onSelect: function (suggestion) {
                console.log(suggestion);
                town = suggestion;

                $("#city").val(town.data.city);
                $("#country").val(town.data.country);
                $("#region").val(town.data.region);
                $("#street").val(town.data.street);
                $("#index").val(town.data.postal_code);
                $("#building").val(town.data.house);
            }
        });

        function setAddressSameAsOrganizationAddress() {

            const organizationId = $("#organization").val();

            if (organizationId == null)
                return alert("Выберите организацию");

            $.get("/Organizations/GetOrganizationAddressByOrganizationId", { organizationId: organizationId }, function (data) {

                if (data.error != null) {
                    alert("Произошла ошибка при попытке загрузить адрес организации" +
                        "\n\nСведения об ошибке:" +
                        "\nТип ошибки:\n" + data.message.ClassName +
                        "\nInnerException:\n" + data.message.InnerException +
                        "\n\nСтек вызовов:\n" + data.message.StackTraceString);
                    console.log(data);
                }

                $("#country").val(data.country);
                $("#city").val(data.city);
                $("#region").val(data.region);
                $("#street").val(data.street);
                $("#index").val(data.zipCode);
                $("#building").val(data.building);
                $("#office").val(data.office);
            });
        }
    </script>

    <script src="~/js/Contact/contact.js" asp-append-version="true"></script>
}
